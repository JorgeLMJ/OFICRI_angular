<div class="container mt-4">
  <!-- Encabezado -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="text-primary">
      <i class="bi bi-file-earmark-text me-2"></i> Gestión de Documentos
    </h2>
    <button class="btn btn-success" (click)="nuevoDocumento()">
      <i class="bi bi-plus-circle me-2"></i> Nuevo Documento
    </button>
  </div>

  <!-- Buscador -->
  <div class="mb-4">
    <div class="input-group">
      <span class="input-group-text bg-primary text-white">
        <i class="bi bi-search"></i>
      </span>
      <input 
        type="text" 
        class="form-control" 
        placeholder="Buscar por n° oficio, nombre, DNI, delito, situación..." 
        [(ngModel)]="searchTerm" 
        (input)="goToPage(1)">
    </div>
  </div>

  <!-- Grid de Cards -->
  <div class="row g-4">
    <div class="col-12 col-md-6 col-lg-4" *ngFor="let doc of paginatedDocumentos; trackBy: trackById">
      <div class="card shadow-sm h-100 border-0">
        <div class="card-header bg-light d-flex justify-content-between align-items-center">
          <h5 class="mb-0 text-primary"> Registro: {{ doc.nro_registro }}</h5>
          <div class="btn-group" role="group">
            <button type="button" class="btn btn-sm btn-outline-warning" (click)="editarDocumento(doc.id!)"><i class="bi bi-pencil-square"></i></button>
            
            <button type="button" class="btn btn-sm btn-outline-info" (click)="vistaPrevia(doc)"><i class="bi bi-eye me-1"></i></button>
          </div>
        </div>
        <div class="card-body">
          <!-- SECCIÓN 1: OFICIO (AMPLIADA) -->
          <div class="mb-4">
            <h6 class="text-primary mb-3"><i class="bi bi-file-earmark me-2"></i>📄 Oficio</h6>
            <div class="row">
              <div class="col-12 mb-2"><strong><i class="bi bi-calendar-date me-2 text-primary"></i>Fecha Ingreso:</strong><p class="mb-1">{{ formatDate(doc.fechaIngreso) }}</p></div>
              <div class="col-12 mb-2"><strong><i class="bi bi-hash me-2 text-primary"></i>N° Oficio:</strong><p class="mb-1">{{ doc.nroOficio }}</p></div>
              <div class="col-12 mb-2"><strong><i class="bi bi-hash me-2 text-primary"></i>Nombre Oficio:</strong><p class="mb-1">{{ doc.nombreOficio }}</p></div>
              <div class="col-12 mb-2"><strong><i class="bi bi-card-text me-2 text-primary"></i>Asunto:</strong><p class="mb-1">{{ doc.asunto }}</p></div>
              <div class="col-12 mb-2"><strong><i class="bi bi-person me-2 text-primary"></i>Nombres:</strong><p class="mb-1">{{ doc.nombres }} {{ doc.apellidos }}</p></div>
              <div class="col-12 mb-2"><strong><i class="bi bi-credit-card me-2 text-primary"></i>DNI:</strong><p class="mb-1">{{ doc.dni }}</p></div>
              <div class="col-12 mb-2"><strong><i class="bi bi-info-circle me-2 text-primary"></i>Situación:</strong><p class="mb-1">{{ doc.situacion }}</p></div>
              <div class="col-12 mb-2"><strong><i class="bi bi-exclamation-triangle me-2 text-primary"></i>Delito/Infracción:</strong><p class="mb-1">{{ doc.delitoInfraccion }}</p></div>
              <div class="col-12 mb-2"><strong><i class="bi bi-clock me-2 text-primary"></i>Incidente:</strong><p class="mb-1">{{ formatDate(doc.fechaIncidente) }} {{ doc.horaIncidente }}</p></div>
              <div class="col-12 mb-2"><strong><i class="bi bi-building me-2 text-primary"></i>Procedencia:</strong><p class="mb-0">{{ doc.procedencia }}</p></div>
            </div>
          </div>

          <!-- SECCIÓN 2: ACTA DE TOMA DE MUESTRA (AMPLIADA) -->
          <div>
            <h6 class="text-primary mb-3"><i class="bi bi-droplet me-2"></i>🧪 Acta de Toma de Muestra</h6>
            <div class="row">
              <div class="col-12 mb-2"><strong><i class="bi bi-calendar-check me-2 text-primary"></i>Fecha Acta:</strong><p class="mb-1">{{ formatDate(doc.fechaActa) || 'N/A' }}</p></div>
              <div class="col-12 mb-2"><strong><i class="bi bi-clock-history me-2 text-primary"></i>Hora Muestra:</strong><p class="mb-1">{{ doc.horaTomaMuestra || 'N/A' }}</p></div>
              <div class="col-12 mb-2"><strong><i class="bi bi-droplet me-2 text-primary"></i>Tipo Muestra:</strong><p class="mb-1">{{ doc.tipoMuestra || 'N/A' }}</p></div>
              <div class="col-12 mb-2"><strong><i class="bi bi-person-vcard me-2 text-primary"></i>Conduce:</strong><p class="mb-1">{{ doc.personaQueConduce || 'N/A' }}</p></div>
              <div class="col-12 mb-2"><strong><i class="bi bi-check-circle me-2 text-primary"></i>Cualitativo:</strong><p class="mb-1">{{ doc.cualitativo || 'N/A' }}</p></div>
              <div class="col-12 mb-2"><strong><i class="bi bi-graph-up me-2 text-primary"></i>Cuantitativo:</strong><p class="mb-0">{{ doc.cuantitativo || 'N/A' }} g/l</p></div>
            </div>
          </div>
          <div *ngIf="getAnexosSeleccionados(doc.anexos) as listaAnexos">
            <div *ngIf="listaAnexos.length > 0">
              <h6 class="text-primary mb-3"><i class="bi bi-paperclip me-2"></i>📎 Anexos</h6>
              <div class="d-flex flex-wrap gap-1">
                <span *ngFor="let anexo of listaAnexos" class="badge bg-secondary fw-normal">
                  {{ anexo }}
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  
  <!-- Sin resultados -->
  <div class="text-center py-5" *ngIf="filteredDocumentos.length === 0">
    <i class="bi bi-search display-4 text-muted mb-3"></i>
    <h5 class="text-muted">No se encontraron documentos</h5>
  </div>

  <!-- Paginación -->
  <div class="d-flex justify-content-center mt-4" *ngIf="filteredDocumentos.length > 0">
    <nav>
      <ul class="pagination">
        <li class="page-item" [class.disabled]="currentPage === 1"><button class="page-link" (click)="prevPage()">Anterior</button></li>
        <li class="page-item" *ngFor="let page of getPageNumbers(); trackBy: trackByPage"><button class="page-link" [class.active]="page === currentPage" (click)="goToPage(page)">{{ page }}</button></li>
        <li class="page-item" [class.disabled]="currentPage === totalPages"><button class="page-link" (click)="nextPage()">Siguiente</button></li>
      </ul>
    </nav>
  </div>
</div>